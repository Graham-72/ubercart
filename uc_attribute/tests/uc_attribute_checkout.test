<?php

class UbercartAttributeCheckoutTestCase extends UbercartTestHelper {

  public static function getInfo() {
    return array(
      'name' => 'Attribute Checkout',
      'description' => 'Test ordering products with attributes.',
      'group' => 'Ubercart',
    );
  }

  function setUp() {
    parent::setUp(array('uc_attribute', 'uc_cart'), array('administer attributes', 'administer product attributes', 'administer product options'));
    $this->drupalLogin($this->adminUser);
  }

  function testAttributeAddToCart() {
    for ($display = 0; $display <= 3; ++$display) {
      // Set up an attribute.
      $data = array(
        'display' => $display,
      );
      $attribute = UbercartAttributeTestCase::createAttribute($data);

      if ($display) {
        // Give the attribute an option.
        $option = UbercartAttributeTestCase::createAttributeOption(array('aid' => $attribute->aid));
      }

      $attribute = uc_attribute_load($attribute->aid);

      // Put the attribute on a product.
      $product = $this->createProduct();
      uc_attribute_subject_save($attribute, 'product', $product->nid, TRUE);

      // Add the product to the cart.
      if ($display == 3) {
        $edit = array($attribute->aid => array($option->oid));
      }
      elseif (isset($option)) {
        $edit = array($attribute->aid => $option->oid);
      }
      else {
        $edit = array($attribute->aid => self::randomName());
      }

      $this->drupalPost('node/'. $product->nid, $edit, t('Add to cart'));
    }
  }

}